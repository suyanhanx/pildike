"use strict";function VNode(){}function getGlobal(){return"object"==typeof global&&global&&global.Math===Math&&global.Array===Array?global:self||window||global||function(){return this}()}var options={store:null,root:getGlobal()},stack=[],EMPTY_CHILDREN=[];function h(e,t){var n,r,i,o,a=EMPTY_CHILDREN;for(o=arguments.length;o-- >2;)stack.push(arguments[o]);for(t&&null!=t.children&&(stack.length||stack.push(t.children),delete t.children);stack.length;)if((r=stack.pop())&&void 0!==r.pop)for(o=r.length;o--;)stack.push(r[o]);else"boolean"==typeof r&&(r=null),(i="function"!=typeof e)&&(null==r?r="":"number"==typeof r?r=String(r):"string"!=typeof r&&(i=!1)),i&&n?a[a.length-1]+=r:a===EMPTY_CHILDREN?a=[r]:a.push(r),n=i;var s=new VNode;return s.nodeName=e,s.children=a,s.attributes=null==t?void 0:t,s.key=null==t?void 0:t.key,void 0!==options.vnode&&options.vnode(s),s}function cssToDom(e){var t=document.createElement("style");return t.textContent=e,t}function npn(e){return e.replace(/-(\w)/g,function(e,t){return t.toUpperCase()})}function applyRef(e,t){null!=e&&("function"==typeof e?e(t):e.current=t)}!function(){if(void 0!==window.Reflect&&void 0!==window.customElements&&!window.customElements.hasOwnProperty("polyfillWrapFlushCallback")){var e=HTMLElement;window.HTMLElement=function(){return Reflect.construct(e,[],this.constructor)},HTMLElement.prototype=e.prototype,HTMLElement.prototype.constructor=HTMLElement,Object.setPrototypeOf(HTMLElement,e)}}();var defer="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function isArray(e){return"[object Array]"===Object.prototype.toString.call(e)}function nProps(e){if(!e||isArray(e))return{};var t={};return Object.keys(e).forEach(function(n){t[n]=e[n].value}),t}var IS_NON_DIMENSIONAL=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i;function isSameNodeType(e,t,n){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&isNamedNode(e,t.nodeName):n||e._componentConstructor===t.nodeName}function isNamedNode(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function createNode(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.normalizedNodeName=e,n}function removeNode(e){var t=e.parentNode;t&&t.removeChild(e)}function setAccessor(e,t,n,r,i){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)applyRef(n,null),applyRef(r,e);else if("class"!==t||i)if("style"===t){if(r&&"string"!=typeof r&&"string"!=typeof n||(e.style.cssText=r||""),r&&"object"==typeof r){if("string"!=typeof n)for(var o in n)o in r||(e.style[o]="");for(var o in r)e.style[o]="number"==typeof r[o]&&!1===IS_NON_DIMENSIONAL.test(o)?r[o]+"px":r[o]}}else if("dangerouslySetInnerHTML"===t)r&&(e.innerHTML=r.__html||"");else if("o"==t[0]&&"n"==t[1]){var a=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),r?n||e.addEventListener(t,eventProxy,a):e.removeEventListener(t,eventProxy,a),(e._listeners||(e._listeners={}))[t]=r}else if("list"!==t&&"type"!==t&&!i&&t in e){try{e[t]=null==r?"":r}catch(e){}null!=r&&!1!==r||"spellcheck"==t||e.removeAttribute(t)}else{var s=i&&t!==(t=t.replace(/^xlink:?/,""));null==r||!1===r?s?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"string"==typeof r&&(s?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):e.setAttribute(t,r))}else e.className=r||""}function eventProxy(e){return this._listeners[e.type](options.event&&options.event(e)||e)}var diffLevel=0,isSvgMode=!1,hydrating=!1;function diff(e,t,n,r,i,o){var a;if(diffLevel++||(isSvgMode=null!=i&&void 0!==i.ownerSVGElement,hydrating=null!=e&&!("__preactattr_"in e)),isArray(t)){a=[];var s=null;isArray(e)?(s=e[0].parentNode,e.forEach(function(e,i){a.push(idiff(e,t[i],n,r,o))})):t.forEach(function(t){a.push(idiff(e,t,n,r,o))}),i?a.forEach(function(e){i.appendChild(e)}):isArray(e)&&e.forEach(function(e){s.appendChild(e)})}else a=idiff(e,t,n,r,o),i&&a.parentNode!==i&&i.appendChild(a);return--diffLevel||(hydrating=!1),a}function idiff(e,t,n,r,i){var o=e,a=isSvgMode;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||i)?e.nodeValue!=t&&(e.nodeValue=t):(o=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(o,e),recollectNodeTree(e,!0))),o.__preactattr_=!0,o;var s=t.nodeName;if(isSvgMode="svg"===s||"foreignObject"!==s&&isSvgMode,s=String(s),(!e||!isNamedNode(e,s))&&(o=createNode(s,isSvgMode),e)){for(;e.firstChild;)o.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(o,e),recollectNodeTree(e,!0)}var l=o.firstChild,c=o.__preactattr_,p=t.children;if(null==c){c=o.__preactattr_={};for(var d=o.attributes,h=d.length;h--;)c[d[h].name]=d[h].value}return!hydrating&&p&&1===p.length&&"string"==typeof p[0]&&null!=l&&void 0!==l.splitText&&null==l.nextSibling?l.nodeValue!=p[0]&&(l.nodeValue=p[0]):(p&&p.length||null!=l)&&innerDiffNode(o,p,n,r,hydrating||null!=c.dangerouslySetInnerHTML),diffAttributes(o,t.attributes,c),isSvgMode=a,o}function innerDiffNode(e,t,n,r,i){var o,a,s,l,c,p=e.childNodes,d=[],h={},u=0,f=0,g=p.length,v=0,y=t?t.length:0;if(0!==g)for(var b=0;b<g;b++){var m=p[b],x=m.__preactattr_;null!=(w=y&&x?m._component?m._component.__key:x.key:null)?(u++,h[w]=m):(x||(void 0!==m.splitText?!i||m.nodeValue.trim():i))&&(d[v++]=m)}if(0!==y)for(b=0;b<y;b++){var w;if(c=null,null!=(w=(l=t[b]).key))u&&void 0!==h[w]&&(c=h[w],h[w]=void 0,u--);else if(!c&&f<v)for(o=f;o<v;o++)if(void 0!==d[o]&&isSameNodeType(a=d[o],l,i)){c=a,d[o]=void 0,o===v-1&&v--,o===f&&f++;break}c=idiff(c,l,n,r),s=p[b],c&&c!==e&&c!==s&&(null==s?e.appendChild(c):c===s.nextSibling?removeNode(s):e.insertBefore(c,s))}if(u)for(var b in h)void 0!==h[b]&&recollectNodeTree(h[b],!1);for(;f<=v;)void 0!==(c=d[v--])&&recollectNodeTree(c,!1)}function recollectNodeTree(e,t){null!=e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),!1!==t&&null!=e.__preactattr_||removeNode(e),removeChildren(e)}function removeChildren(e){for(e=e.lastChild;e;){var t=e.previousSibling;recollectNodeTree(e,!0),e=t}}function diffAttributes(e,t,n){var r,i=!1,o=e.update;for(r in n)t&&null!=t[r]||null==n[r]||(setAccessor(e,r,n[r],n[r]=void 0,isSvgMode),o&&(delete e.props[r],i=!0));for(r in t)o&&"object"==typeof t[r]?(e.props[npn(r)]=t[r],i=!0):"children"===r||"innerHTML"===r||r in n&&t[r]===("value"===r||"checked"===r?e[r]:n[r])||(setAccessor(e,r,n[r],n[r]=t[r],isSvgMode),o&&(e.props[npn(r)]=t[r],i=!0));e.parentNode&&i&&o&&e.update()}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var WeElement=function(e){function t(){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,e.call(this));return n.props=nProps(n.constructor.props),n.data=n.constructor.data||{},n}return _inherits(t,e),t.prototype.connectedCallback=function(){if(!this.constructor.pure){for(var e=this.parentNode;e&&!this.store;)this.store=e.store,e=e.parentNode||e.host;this.store&&this.store.instances.push(this)}this.install(),options.afterInstall&&options.afterInstall(this);var t=this.attachShadow({mode:"open"});this.css&&t.appendChild(cssToDom(this.css())),this.beforeRender(),this.host=diff(null,this.render(this.props,!this.constructor.pure&&this.store?this.store.data:this.data),{},!1,null,!1),isArray(this.host)?this.host.forEach(function(e){t.appendChild(e)}):t.appendChild(this.host),this.installed(),this._isInstalled=!0},t.prototype.disconnectedCallback=function(){if(this.uninstall(),this.store)for(var e=0,t=this.store.instances.length;e<t;e++)if(this.store.instances[e]===this){this.store.instances.splice(e,1);break}},t.prototype.update=function(){this.beforeUpdate(),this.beforeRender(),diff(this.host,this.render(this.props,!this.constructor.pure&&this.store?this.store.data:this.data)),this.afterUpdate()},t.prototype.fire=function(e,t){this.dispatchEvent(new CustomEvent(e,{detail:t}))},t.prototype.install=function(){},t.prototype.installed=function(){},t.prototype.uninstall=function(){},t.prototype.beforeUpdate=function(){},t.prototype.afterUpdate=function(){},t.prototype.beforeRender=function(){},t}(HTMLElement),JSONPatcherProxy=function(){function e(e){return-1==e.indexOf("/")&&-1==e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function t(e,t){for(var n=[],r=e.parenthoodMap.get(t);r&&r.path;)n.unshift(r.path),r=e.parenthoodMap.get(r.parent);return n.length?"/"+n.join("/"):""}function n(e,t){this.isProxifyingTreeNow=!1,this.isObserving=!1,this.proxifiedObjectsMap=new Map,this.parenthoodMap=new Map,"boolean"!=typeof t&&(t=!0),this.showDetachedWarning=t,this.originalObject=e,this.cachedProxy=null,this.isRecording=!1,this.userCallback,this.resume=function(){var e=this;this.defaultCallback=function(t){e.isRecording&&e.patches.push(t),e.userCallback&&e.userCallback(t)},this.isObserving=!0}.bind(this),this.pause=function(){this.defaultCallback=function(){},this.isObserving=!1}.bind(this)}return n.deepClone=function(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}},n.escapePathComponent=e,n.prototype.generateProxyAtPath=function(n,r,i){var o=this;if(!r)return r;var a={set:function(n,r,i,a){return function(n,r,i,o){var a=t(n,r)+"/"+e(i);if(n.proxifiedObjectsMap.has(o)){var s=n.proxifiedObjectsMap.get(o);n.parenthoodMap.set(s.originalObject,{parent:r,path:i})}var l=n.proxifiedObjectsMap.get(o);l&&!n.isProxifyingTreeNow&&(l.inherited=!0),o&&"object"==typeof o&&!n.proxifiedObjectsMap.has(o)&&(n.parenthoodMap.set(o,{parent:r,path:i}),o=n._proxifyObjectTreeRecursively(r,o,i));var c={op:"remove",path:a};if(void 0===o){if(!Array.isArray(r)&&!r.hasOwnProperty(i))return Reflect.set(r,i,o);Array.isArray(r)&&(c.op="replace",c.value=null);var p=n.proxifiedObjectsMap.get(r[i]);p&&(n.parenthoodMap.delete(r[i]),n.disableTrapsForProxy(p),n.proxifiedObjectsMap.delete(p))}else{if(Array.isArray(r)&&!Number.isInteger(+i.toString()))return"length"!=i&&console.warn("JSONPatcherProxy noticed a non-integer prop was set for an array. This will not emit a patch"),Reflect.set(r,i,o);c.op="add",r.hasOwnProperty(i)&&(void 0!==r[i]||Array.isArray(r))&&(c.op="replace"),c.value=o}var d=Reflect.set(r,i,o);return n.defaultCallback(c),d}(o,n,r,i)},deleteProperty:function(n,r){return function(n,r,i){if(void 0!==r[i]){var o=t(n,r)+"/"+e(i),a=n.proxifiedObjectsMap.get(r[i]);a&&(a.inherited?a.inherited=!1:(n.parenthoodMap.delete(a.originalObject),n.disableTrapsForProxy(a),n.proxifiedObjectsMap.delete(r[i])));var s=Reflect.deleteProperty(r,i);return n.defaultCallback({op:"remove",path:o}),s}}(o,n,r)}},s=Proxy.revocable(r,a);return s.trapsInstance=a,s.originalObject=r,this.parenthoodMap.set(r,{parent:n,path:i}),this.proxifiedObjectsMap.set(s.proxy,s),s.proxy},n.prototype._proxifyObjectTreeRecursively=function(t,n,r){for(var i in n)n.hasOwnProperty(i)&&n[i]instanceof Object&&(n[i]=this._proxifyObjectTreeRecursively(n,n[i],e(i)));return this.generateProxyAtPath(t,n,r)},n.prototype.proxifyObjectTree=function(e){this.pause(),this.isProxifyingTreeNow=!0;var t=this._proxifyObjectTreeRecursively(void 0,e,"");return this.isProxifyingTreeNow=!1,this.resume(),t},n.prototype.disableTrapsForProxy=function(e){if(this.showDetachedWarning){var t="You're accessing an object that is detached from the observedObject tree, see https://github.com/Palindrom/JSONPatcherProxy#detached-objects";e.trapsInstance.set=function(e,n,r){return console.warn(t),Reflect.set(e,n,r)},e.trapsInstance.set=function(e,n,r){return console.warn(t),Reflect.set(e,n,r)},e.trapsInstance.deleteProperty=function(e,t){return Reflect.deleteProperty(e,t)}}else delete e.trapsInstance.set,delete e.trapsInstance.get,delete e.trapsInstance.deleteProperty},n.prototype.observe=function(e,t){if(!e&&!t)throw new Error("You need to either record changes or pass a callback");return this.isRecording=e,this.userCallback=t,e&&(this.patches=[]),this.cachedProxy=this.proxifyObjectTree(this.originalObject),this.cachedProxy},n.prototype.generate=function(){if(!this.isRecording)throw new Error("You should set record to true to get patches later");return this.patches.splice(0,this.patches.length)},n.prototype.revoke=function(){this.proxifiedObjectsMap.forEach(function(e){e.revoke()})},n.prototype.disableTraps=function(){this.proxifiedObjectsMap.forEach(this.disableTrapsForProxy,this)},n}(),timeout=null,patchs={},handler=function(e,t){if(clearTimeout(timeout),"remove"===e.op){var n=getArrayPatch(e.path,t);patchs[n.k]=n.v,timeout=setTimeout(function(){update(patchs,t),patchs={}})}else{var r=fixPath(e.path);patchs[r]=e.value,timeout=setTimeout(function(){update(patchs,t),patchs={}})}};function render(e,t,n){t="string"==typeof t?document.querySelector(t):t,n&&(n.instances=[],extendStoreUpate(n),n.data=new JSONPatcherProxy(n.data).observe(!0,function(e){handler(e,n)}),t.store=n),diff(null,e,{},!1,t,!1)}function update(e,t){t.update(e)}function extendStoreUpate(e){e.update=function(e){var t=this,n=matchGlobalData(this.globalData,e);Object.keys(e).length>0&&(this.instances.forEach(function(r){(n||t.updateAll||r.constructor.updatePath&&needUpdate(e,r.constructor.updatePath))&&r.update()}),this.onChange&&this.onChange(e))}}function matchGlobalData(e,t){if(!e)return!1;for(var n in t){if(e.indexOf(n)>-1)return!0;for(var r=0,i=e.length;r<i;r++)if(includePath(n,e[r]))return!0}return!1}function needUpdate(e,t){for(var n in e){if(t[n])return!0;for(var r in t)if(includePath(n,r))return!0}return!1}function includePath(e,t){if(0===e.indexOf(t)){var n=e.substr(t.length,1);if("["===n||"."===n)return!0}return!1}function fixPath(e){var t="";return e.replace("/","").split("/").forEach(function(e,n){n?isNaN(Number(e))?t+="."+e:t+="["+e+"]":t+=e}),t}function getArrayPatch(e,t){for(var n=e.replace("/","").split("/"),r=t.data[n[0]],i=1,o=n.length;i<o-1;i++)r=r[n[i]];return{k:fixArrPath(e),v:r}}function fixArrPath(e){var t="",n=e.replace("/","").split("/"),r=n.length;return n.forEach(function(e,n){n<r-1&&(n?isNaN(Number(e))?t+="."+e:t+="["+e+"]":t+=e)}),t}function define(e,t){customElements.define(e,t),t.data&&!t.pure&&(t.updatePath=getUpdatePath(t.data))}function getUpdatePath(e){var t={};return dataToPath(e,t),t}function dataToPath(e,t){Object.keys(e).forEach(function(n){t[n]=!0;var r=Object.prototype.toString.call(e[n]);"[object Object]"===r?_objToPath(e[n],n,t):"[object Array]"===r&&_arrayToPath(e[n],n,t)})}function _objToPath(e,t,n){Object.keys(e).forEach(function(r){n[t+"."+r]=!0,delete n[t];var i=Object.prototype.toString.call(e[r]);"[object Object]"===i?_objToPath(e[r],t+"."+r,n):"[object Array]"===i&&_arrayToPath(e[r],t+"."+r,n)})}function _arrayToPath(e,t,n){e.forEach(function(e,r){n[t+"["+r+"]"]=!0,delete n[t];var i=Object.prototype.toString.call(e);"[object Object]"===i?_objToPath(e,t+"["+r+"]",n):"[object Array]"===i&&_arrayToPath(e,t+"["+r+"]",n)})}function tag(e,t){return function(n){n.pure=t,define(e,n)}}var omi={tag,WeElement,render,h,createElement:h,options,define};options.root.Omi=omi,options.root.Omi.version="4.0.6";class Uploader extends WeElement{install(){this.previewFile=this.previewFile.bind(this),this.inputUpload=this.inputUpload.bind(this),this.ready=this.ready.bind(this),this.images=[]}installed(){["dragenter","dragover","dragleave","drop"].forEach(e=>{this.addEventListener(e,this.preventDefault,!1)}),["drop"].forEach(e=>{this.addEventListener(e,this.handleDrop,!1)}),this.ondragenter=(()=>this.classList.add("highlight")),this.ondragleave=(()=>this.classList.remove("highlight")),this.ondragend=(()=>this.classList.remove("highlight")),this.onclick=(()=>this.shadowRoot.querySelector("#file_uploader").click()),this.shadowRoot.querySelector("#file_uploader").addEventListener("change",this.inputUpload,!1)}ready(e){this.preventDefault(e),this.fire("upload",{images:this.images})}css(){return`:host {\n            display:grid;\n            padding:15px;\n            width:${this.getAttribute("width")};\n          }\n          .highlight {\n            background:#e67e22;\n          }\n          #upload-container.filled {\n            background-image:none;\n          }\n          #upload-container {\n            background-image:url(${this.getAttribute("background")});\n            background-repeat:no-repeat;\n            background-size:contain;\n            background-position:50% 15px;\n            cursor:pointer;\n            position:relative;\n            width:100%;\n            min-width:${this.getAttribute("width")};\n            min-height:500px;\n            display:grid;\n            border:dashed 1px #2c3e50;\n            box-sizing:content-box;\n          }\n          #image-previews {\n            display:grid;\n            grid-template-columns: repeat(3, 0.4fr);\n            grid-auto-rows: max-content;\n            grid-column-gap:20px;\n            grid-row-gap:30px;\n            padding:20px;\n          }\n          #image-previews img {\n            height:150px;\n            width:100%;\n            display:block;\n          }\n          #image-previews .image-info span {\n            font-size:11px;\n            text-align:center;\n            padding:6px 3px;\n          }\n          .image-info {\n            box-shadow: 2px 1px 5px 1px #7f8c8d;\n            display:grid;\n            position:relative;\n          }\n          .delete-image {\n            position: absolute;\n            right: -7px;\n            top: -9px;\n            color: red;\n            background: white;\n            border-radius: 50%;\n            width: 17px;\n            height: 13px;\n            box-shadow: 1px 1px 2px 1px #7f8c8d;\n          }\n          #ready-button {\n            position: absolute;\n            right: -1px;\n            bottom: -40px;\n            background: #4CAF50;\n            font-size: 20px;\n            padding: 5px 10px;\n            width: 105px;\n            text-align: center;\n            color: #fafbfb;\n            border-radius: 4px;\n            transition:0.2s ease-in-out;\n          }\n          #ready-button:hover {\n            background: teal;\n            transition:0.2s ease-in-out;\n          }\n          `}preventDefault(e){e.preventDefault(),e.stopPropagation()}handleDrop(e){this.preventDefault(e),[...e.dataTransfer.files].forEach(e=>this.previewFile(e)),this.classList.remove("highlight")}inputUpload(e){[...e.target.files].forEach(e=>this.previewFile(e))}previewFile(e){let t=new FileReader;t.readAsDataURL(e),t.onloadend=(()=>{const n=Math.floor(1e3*Math.random())+1;this.images.push({name:e.name,id:n,size:e.size,result:t.result,file:e}),this.update()})}removeImage(e,t){this.preventDefault(t),this.images=this.images.filter(t=>t.id!==e.id),this.update()}render(){return Omi.h("div",{id:"upload-container",class:this.images.length>0?"filled":"empty"},Omi.h("input",{id:"file_uploader",type:"file",style:"display:none;",name:"pictures",accept:"{this.getAttribute('accept')}",multiple:!0}),Omi.h("div",{id:"image-previews"},this.images.map(e=>Omi.h("div",{className:"image-info"},Omi.h("span",{onclick:this.removeImage.bind(this,e),className:"delete-image"},"×"),Omi.h("img",{src:e.result}),Omi.h("span",null,e.name)))),Omi.h("div",{id:"ready-button",onclick:this.ready},"Done"))}}customElements.define("image-uploader",Uploader);
